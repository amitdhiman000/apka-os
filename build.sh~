#!/bin/sh

build=build

echo "=================="
echo "Building Kernel..."
echo "=================="

# Build C files

gcc -wall -O -fstrength-reduce -fomit-frame-pointer -nostdinc -fno-builtin -I./kernel/includes -c -o $build/main.o ./kernel/main.c -fno-strict-aliasing -fno-common -fno-stack-protector


# Build ASM files

nasm -f elf .kernel/loader.asm -o $build/loader.o

# link 
ld -T linker.ld  $build/*.o

# to Put on floppy image
cp boot/os.img  os.img
#mounting on Floppy image
mkdir /media/test1
mount -o loop os.img /media/test1
cp kernel.bin /media/test1
rm -r /media/test1

